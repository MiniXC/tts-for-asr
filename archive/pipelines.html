
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta property="og:title" content="Document your project" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="cdminix.me/archive/pipelines.html" />
  
<meta property="og:description" content="Research code is written in spurts and fits. You will often put code aside for several months and focus your energy on experiments, passing qualifying exams or working on another project. When you ..." />
  
<meta property="og:image" content="https://goodresearch.dev/_images/unicorn.png" />
  
<meta property="og:image:alt" content="Document your project" />
  
    <title>Document your project &#8212; TTS for ASR</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
  <!-- add `style` or `link` tags with your CSS `@font-face` declarations here -->
  <!-- ... and optionally preload the `woff2` for snappier page loads -->
  <link rel="preload" href="../_static/et-book/et-book-bold-line-figures/et-book-bold-line-figures.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="../_static/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="../_static/et-book/et-book-roman-line-figures/et-book-roman-line-figures.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="../_static/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.woff" as="font" type="font/woff" crossorigin>
  <link rel="preload" href="../_static/et-book/et-book-semi-bold-old-style-figures/et-book-semi-bold-old-style-figures.woff" as="font" type="font/woff" crossorigin>

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.59e7d1499aa759519747cb2a1a335dc4.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tufte.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.90c857b2bf8f3d46aa488b0ed8bf60a6.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://cdminix.me/tts-for-asr/archive/pipelines.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@patrickmineault" />
    <meta name="twitter:title" content="The Good Research Code Handbook" />
    <meta name="twitter:description" content="This handbook is for grad students, postdocs and PIs who do a lot of programming as part of their research. It will teach you, in a practical manner, how to organize your code so that it is easy to understand and works reliably." />
    <meta name="twitter:image" content="https://goodresearch.dev/_images/unicorn.png" />

    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3Q6LDVNS0X"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-3Q6LDVNS0X');
    </script>
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/one.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">TTS for ASR</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   TTS for Low-Resource ASR
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Fundmentals
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/other_fields.html">
   Synthetic Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/tts.html">
   Synthetic Speech
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/low_resource_asr.html">
   Low-Resource ASR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/lr-tts-overview.html">
   Low-Resource TTS
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Combining ASR &amp; TTS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/augmentation.html">
   Data Augmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/transfer.html">
   Knowledge Transfer
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  My Work
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/fastspeech2.html">
   FastSpeech 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/conditioning.html">
   Conditioning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/snr.html">
   SNR Variance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/german-to-english.html">
   German-to-English Transfer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/future.html">
   Future Work
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../markdown/references.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

<nav class="bd-links" id="nav-social">
    <div class="bd-toc-item">
        <p class="caption">
            <span class="caption-text">Social</span>
        </p>
        <ul class="nav bd-sidenav" style="display:block">
            <li class="toctree-l1"><a class="github-button" href="https://github.com/patrickmineault/codebook" data-icon="octicon-star" data-show-count="true" data-size="large" aria-label="Star patrickmineault/codebook on GitHub">Star on Github</a></li>
            <li class="toctree-l1"><a href="http://eepurl.com/hHgNOH">Subscribe for updates</a></li>
            <li class="toctree-l1"><a href="http://twitter.com/share?text=The+Good+Research+Code+Handbook.+Learn+to+write+readable%2C+maintainable+research+code+in+Python.&url=https://goodresearch.dev&user&via=patrickmineault" class="twitter-share-button" data-text="The Good Research Code Handbook. Learn to write readable, maintainable code in Python." data-via="patrickmineault" data-show-count="false">Tweet this handbook</a></li>
        </ul>
    </div>
</nav>
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/archive/pipelines.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/cdminix/tts-for-asr"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/cdminix/tts-for-asr/issues/new?title=Issue%20on%20page%20%2Farchive/pipelines.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/cdminix/tts-for-asr/edit/main/./archive/pipelines.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#document-pipelines">
   Document pipelines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#write-console-programs">
     Write console programs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#commit-shell-files">
     Commit shell files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#document-pipelines-with-make">
     Document pipelines with make
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#record-the-provenance-of-each-figure-and-table">
     Record the provenance of each figure and table
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#document-projects">
   Document projects
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#write-a-readme-md-file">
     Write a
     <code class="docutils literal notranslate">
      <span class="pre">
       README.md
      </span>
     </code>
     file
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#write-markdown-docs">
     Write Markdown docs
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="document-your-project">
<h1>Document your project<a class="headerlink" href="#document-your-project" title="Permalink to this headline">¶</a></h1>
<p>Research code is written in spurts and fits. You will often put code aside for several months and focus your energy on experiments, passing qualifying exams or working on another project. When you come back to your original project, you will be lost. A little prep work by writing docs will help you preserve your knowledge over the long run. In the previous chapter, I showed how to document small units of your code. In this section, I talk about how to document entire projects.</p>
<div class="section" id="document-pipelines">
<h2>Document pipelines<a class="headerlink" href="#document-pipelines" title="Permalink to this headline">¶</a></h2>
<p>It’s a common practice to use graphical tools (GUIs) to perform analyses. It also happens more often than most people are willing to admit that different variants of a pipeline are run by commenting and un-commenting code. Both of these practices make it hard to reproduce a result 6 months down the line. What was run, and when?</p>
<p>One approach is to textually document in detail what piece of code was run to obtain results. This method can be tedious and error-prone. It’s usually worth it to push as much computation as possible into reproducible pipelines which are self-documenting. That way, there’s no ambiguity about how results were produced.</p>
<p>Manual steps involving GUI tools should produce results which can be ingested by text-based pipelines. For instance, a interactive GUI to define regions-of-interest (ROI) should export the ROI coordinates in a way that the pipeline can ingest it.</p>
<div class="section" id="write-console-programs">
<h3>Write console programs<a class="headerlink" href="#write-console-programs" title="Permalink to this headline">¶</a></h3>
<p>Instead of commenting and un-commenting code, we can have different code paths execute depending on flags passed as command line arguments. Console programs can be written through the <code class="docutils literal notranslate"><span class="pre">argparse</span></code> library, which is part of the Python standard library, or through external libraries like <code class="docutils literal notranslate"><span class="pre">click</span></code>. As a side benefit, these libraries document the intent of the flags and generate help for them.</p>
<p>Let’s say you create a command line program <code class="docutils literal notranslate"><span class="pre">train_net.py</span></code> that trains a neural net. This training script has four parameters you could change: model type, number of iterations, input directory, output directory. Rather than changing these variables in the source code, you can pass them as command line arguments. Here’s how you can write that:</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Real training scripts for neural nets can take dozens of parameters. <a class="reference external" href="https://github.com/patrickmineault/your-head-is-there-to-move-you-around/blob/main/train_net.py#L677">Here’s an example</a>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># TODO(pmin): Implement a neural net here.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>  <span class="c1"># Prints the model type.</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Train a neural net&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--model&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Model type (resnet or alexnet)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--niter&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of iterations&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--in_dir&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Input directory with images&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--out_dir&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output directory with trained model&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>A nice side benefit of using <code class="docutils literal notranslate"><span class="pre">argparse</span></code> is that it automatically generates help at the command line.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ python train_net.py -h
usage: train_net.py <span class="o">[</span>-h<span class="o">]</span> --model MODEL <span class="o">[</span>--niter NITER<span class="o">]</span> --in_dir IN_DIR --out_dir OUT_DIR

Train a neural net

optional arguments:
  -h, --help         show this <span class="nb">help</span> message and <span class="nb">exit</span>
  --model MODEL      Model <span class="nb">type</span> <span class="o">(</span>resnet or alexnet<span class="o">)</span>
  --niter NITER      Number of iterations
  --in_dir IN_DIR    Input directory with images
  --out_dir OUT_DIR  Output directory with trained model
</pre></div>
</div>
<p>External flags thus allow you to run different versions of the same script in a standardized way.</p>
</div>
<div class="section" id="commit-shell-files">
<h3>Commit shell files<a class="headerlink" href="#commit-shell-files" title="Permalink to this headline">¶</a></h3>
<p>Once you’ve refactored your code to take configuration as command line flags, you should record the flags that you used when you invoke your code. You can do this using a <em>shell file</em>. A shell file contains multiple shell commands that are run one after the other.</p>
<p>Consider a long-running pipeline involving <code class="docutils literal notranslate"><span class="pre">train_net.py</span></code>. This pipeline starts with downloading images from the internet stored in an AWS S3 bucket; trains a neural net; then generates plots. We can document this pipeline with a shell file. In <code class="docutils literal notranslate"><span class="pre">pipeline.sh</span></code>, we have:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># This will cause bash to stop executing the script if there&#39;s an error</span>
<span class="nb">set</span> -e

<span class="c1"># Download files</span>
aws s3 cp s3://codebook-testbucket/images/ data/images --recursive

<span class="c1"># Train network</span>
python scripts/train_net.py --model resnet --niter <span class="m">100000</span> --in_dir data/images --out_dir results/trained_model

<span class="c1"># Create output directory</span>
mkdir results/figures/

<span class="c1"># Generate plots</span>
python scripts/generate_plots.py --in_dir data/images --out_dir results/figures/ --ckpt results/trained_model/model.ckpt
</pre></div>
</div>
<p>This shell file serves both as runnable code and as documentation for the pipeline. Now we know how our figure was generated! Don’t forget to check in this shell file to git to have a record of this file.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Bash is quirky - the syntax is awkward and it’s pretty easy to shoot yourself in the foot. If you’re going to write elaborate shell scripts,  use <a class="reference external" href="https://github.com/koalaman/shellcheck"><code class="docutils literal notranslate"><span class="pre">shellcheck</span></code></a>, which will point out common mistakes in your code. Your favorite editor probably has a plugin for <code class="docutils literal notranslate"><span class="pre">shellcheck</span></code>.</p>
<p>Also, check out <a class="reference external" href="https://wizardzines.com/zines/bite-size-command-line/">Julia Evans’ zine</a> on bash - it’s a life saver.</p>
</div>
</div>
<div class="section" id="document-pipelines-with-make">
<h3>Document pipelines with make<a class="headerlink" href="#document-pipelines-with-make" title="Permalink to this headline">¶</a></h3>
<p>Scientific pipelines often take the shape of DAGs - directed acyclic graphs. This means, essentially, that programs flow from inputs to output in a directed fashion. The <code class="docutils literal notranslate"><span class="pre">train_net</span></code> pipeline above is a DAG with 4 steps. Other DAGs can be more elaborate, for example the 12-step DAG which generates figures shown in Van Vliet (2020) <a class="footnote-reference brackets" href="#vanvliet" id="id1">1</a>:</p>
<div class="boxed figure align-default" id="id2">
<img alt="archive/figures/pcbi.1007358.g002.PNG_L.png" src="archive/figures/pcbi.1007358.g002.PNG_L.png" />
<p class="caption"><span class="caption-text">DAG from Van Vliet (2020). CC-BY 4.0</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>You can document how all the steps of the DAG fit together with a bash file. As your pipelines grow, it can be painful to restart a pipeline that fails in the middle. This could lead to a proliferation of bash files corresponding to different subparts of your pipeline, and pretty soon you’ll have a mess of shell scripts on your hands - basically recreating the commenting/uncommenting workflow we had in Python, this time in bash!</p>
<p>You can use a more specialized build tool to build and document a pipeline. GNU <code class="docutils literal notranslate"><span class="pre">make</span></code> has been a standard tool for compiling code for several decades, and is becoming more adopted by the data science and research communities. A <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> specifies both the inputs to each pipeline step and its outputs. To give you a flavor of what a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> looks like, this file implements the DAG to train a neural net and plot diagnostic plots:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">plot</span>
<span class="nf">plot</span><span class="o">:</span> <span class="n">results</span>/<span class="n">trained_model</span>/<span class="n">model</span>.<span class="n">ckpt</span> <span class="n">results</span>/<span class="n">figures</span>
	python scripts/generate_plots.py --in_dir data/images --out_dir results/figures/ --ckpt results/trained_model/model.ckpt

<span class="nf">results/trained_model/model.ckpt</span><span class="o">:</span> <span class="n">data</span>/<span class="n">images</span>
	python scripts/train_net.py --model resnet --niter <span class="m">100000</span> --in_dir data/images --out_dir results/trained_model

<span class="nf">data/images</span><span class="o">:</span>
	aws s3 cp s3://codebook-testbucket/images/ data/images --recursive

<span class="nf">results/figures</span><span class="o">:</span>
	mkdir results/figures/
</pre></div>
</div>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p><code class="docutils literal notranslate"><span class="pre">make</span></code> can be pretty finicky. For instance, you must use <em>tabs</em>, not spaces, to indent.</p>
</div>
<p>The plot can be created with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">plot</span></code>. The <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> contains a complete description of the inputs and outputs to different scripts, and thus serves as a self-documenting artifact. <a class="reference external" href="https://swcarpentry.github.io/make-novice/">Software carpentry</a> has an excellent tutorial on <code class="docutils literal notranslate"><span class="pre">make</span></code>. What’s more, <code class="docutils literal notranslate"><span class="pre">make</span></code> only rebuilds what needs to be rebuilt. In particular, if the network is already trained, <code class="docutils literal notranslate"><span class="pre">make</span></code> will detect it and won’t retrain the network again, skipping ahead to the plotting task.</p>
<p><code class="docutils literal notranslate"><span class="pre">make</span></code> uses a domain-specific language (DSL) to define a DAG. It might feel daunting to learn yet another language to document a pipeline. There are numerous alternatives to <code class="docutils literal notranslate"><span class="pre">make</span></code> that define DAGs in pure Python, including <a class="reference external" href="https://pydoit.org/"><code class="docutils literal notranslate"><span class="pre">doit</span></code></a>. There are also more complex tools that can implement Python DAGs and run them in the cloud, including <a class="reference external" href="https://github.com/spotify/luigi"><code class="docutils literal notranslate"><span class="pre">luigi</span></code></a>, <a class="reference external" href="https://airflow.apache.org/"><code class="docutils literal notranslate"><span class="pre">airflow</span></code></a>, and <a class="reference external" href="https://docs.dask.org/en/latest/custom-graphs.html"><code class="docutils literal notranslate"><span class="pre">dask</span></code></a>.</p>
</div>
<div class="section" id="record-the-provenance-of-each-figure-and-table">
<h3>Record the provenance of each figure and table<a class="headerlink" href="#record-the-provenance-of-each-figure-and-table" title="Permalink to this headline">¶</a></h3>
<p>Before you submit a manuscript, you should create a canonical version of the pipeline used to generate the figures and tables in the paper, and re-run the pipeline from scratch. That way, there will be no ambiguity as to the provenance of a figure in the final paper - it was generated by the canonical version of the pipeline.</p>
<p>However, before you get to this final state, it’s all too easy to lose track of which result was generated by which version of the pipeline. It is extremely frustrating when your results change and you can’t figure out why. If you check in figures and results to source control as you generate them, in theory you have access to a time machine. However, there’s information embedded in figures and tables about the state of the code <em>when the figures were generated</em>, only about the state of the code <em>when the figures were committed</em>, and there can be a significant lag between the two.</p>
<p>A lightweight workaround is to record the git hash with each result. The git hash is a long string of random digits corresponding to a git commit. You can see these hashes using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git log
<span class="go">commit 3b0c0665465a8ea4cd862058e107b76041acae0f (HEAD -&gt; main, origin/main)</span>
<span class="go">Author: Patrick Mineault &lt;patrick.mineault@gmail.com&gt;</span>
<span class="go">Date:   Wed Sep 8 13:34:31 2021 -0400</span>

<span class="go">    Clean up setup instructions</span>

<span class="go">commit 70deb0e7c9bffe4cdc73d813df8115d99606601c</span>
<span class="go">Author: Patrick Mineault &lt;patrick.mineault@gmail.com&gt;</span>
<span class="go">Date:   Wed Sep 8 00:41:10 2021 -0400</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">3b0c06...</span></code> is the git hash of my latest commit. You can read the current git hash using the <code class="docutils literal notranslate"><span class="pre">gitpython</span></code> library and append it to the name of file. For example, instead of recording <code class="docutils literal notranslate"><span class="pre">figure.png</span></code>, I can record <code class="docutils literal notranslate"><span class="pre">figure.3b0c066546.png</span></code> using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">git</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">repo</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">Repo</span><span class="p">(</span><span class="n">search_parent_directories</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">short_hash</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">hexsha</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>

<span class="c1"># Plotting code goes here...</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;figure.</span><span class="si">{</span><span class="n">short_hash</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now there’s no ambiguity about how that figure was generated. You can repeat the same process with csv files and other results.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Most services in this this space are closed-source, cloud-based commercial services available for free to researchers. <a class="reference external" href="https://wandb.ai/">Wandb</a> and <a class="reference external" href="https://neptune.ai/">Neptune</a> record machine learning results. <a class="reference external" href="https://gigantum.com">Gigantum</a> keeps a rich log of jupyter notebook executions. <code class="docutils literal notranslate"><span class="pre">datalad</span></code> is libre software that can <a class="reference external" href="http://docs.datalad.org/en/stable/generated/man/datalad-run.html">record and document dataset manipulations</a>.</p>
</div>
<p>A more full-featured way of doing this is to use a specialized tool to post results to a centralized database. Most of the offerings in this space are cloud-based commercial services. You post your results - whether scalars, whole tables, figures, etc. - to a centralized server through a bit of python code, and it takes care of versioning. In the screenshot below, I used <a class="reference external" href="https://wandb.ai/">wandb.ai</a> to record the outcome of a machine learning pipeline. The record tells me what command that was run, the git hash, meta-information about which computer was used to run the pipeline, as well as the outcome. There is no ambiguity about provenance.</p>
<div class="boxed figure align-default" id="id3">
<a class="reference internal image-reference" href="archive/figures/wandb.png"><img alt="archive/figures/wandb.png" src="archive/figures/wandb.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Record of one deep-learning run in wandb.ai</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="document-projects">
<h2>Document projects<a class="headerlink" href="#document-projects" title="Permalink to this headline">¶</a></h2>
<p>In addition to documenting pipelines, it’s important to write proper textual documentation for your project. The secret is that once you’ve written good unit tests and have documented your pipelines, you won’t have a lot of text docs to write.</p>
<div class="section" id="write-a-readme-md-file">
<h3>Write a <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file<a class="headerlink" href="#write-a-readme-md-file" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">README.md</span></code> is the often first entry point to your code that you and others will see. This is the file that’s rendered when you navigate to your git repository. What are some of the elements in a good README?</p>
<ul class="simple">
<li><p>A one-sentence description of your project</p></li>
<li><p>A longer description of your project</p></li>
<li><p>Installation instructions</p></li>
<li><p>General orientation to the codebase and usage instructions</p></li>
<li><p>Links to papers</p></li>
<li><p>Links to extended docs</p></li>
<li><p>License</p></li>
</ul>
<p>Importantly, keep your <code class="docutils literal notranslate"><span class="pre">README.md</span></code> up-to-date. A good <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file helps strangers understand the value of your code: it’s as important as a paper’s abstract.</p>
</div>
<div class="section" id="write-markdown-docs">
<h3>Write Markdown docs<a class="headerlink" href="#write-markdown-docs" title="Permalink to this headline">¶</a></h3>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Different environments support slightly different variants of Markdown - Remarkable, CommonMark, MyST, pandoc</p>
</div>
<p>Markdown has taken over the world of technical writing. Using the same format everywhere creates tremendous opportunities, so I highly recommend that you write your documentation in Markdown. With the same text, you can generate:</p>
<ul class="simple">
<li><p><em>Digital notes</em>. <a class="reference external" href="https://notion.so/">Notion</a>, <a class="reference external" href="https://notable.app/">notable</a>, <a class="reference external" href="https://obsidian.md/">Obsidian</a>, <a class="reference external" href="https://hackmd.io/">HackMD</a>, GitHub.</p></li>
<li><p><em>Blogs</em>. <a class="reference external" href="https://wordpress.com">Wordpress</a>, <a class="reference external" href="https://jekyllrb.com/">Jekyll</a></p></li>
<li><p><em>Wikis</em>. GitHub.</p></li>
<li><p><em>Static sites</em>. <a class="reference external" href="https://jekyllrb.com/">Jekyll</a>, <a class="reference external" href="https://11ty.dev/">eleventy</a>, GitHub Pages</p></li>
<li><p><em>Executable books</em>. <a class="reference external" href="https://jupyterbook.org/">jupyterbook</a> generates this book.</p></li>
<li><p><em>Slide decks</em>. <a class="reference external" href="https://pandoc.org/">Pandoc</a> via conversion to LaTeX/Beamer.</p></li>
<li><p><em>readthedocs-style documentation</em>. <a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx</a> using MyST.</p></li>
</ul>
<p>The same Markdown can be deployed in different environments depending on what exactly you want to accomplish. For some projects, the <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file will be all that is needed. Others will want a static site that shows highlights of the paper. Yet other projects will be well-served by blog posts which discuss in longer form the tradeoffs involved in the design decisions.</p>
<p>Creating your documentation in Markdown you make it really easy for you to eventually migrate to another format. I tend to use a combination of all these tools. For instance, I write notes on papers in Notion; I then export those notes to markdown as stubs for my Wordpress blog, for pandoc slides or for jupyterbook.</p>
<blockquote class="epigraph">
<div><p>Some things are in our control and others not. […] If [a thing] concerns anything not in your control, be prepared to say that it is nothing to you.</p>
<p class="attribution">—Epictetus</p>
</div></blockquote>
<p>Documentation contains the long-term memory of a project. When you’re writing documentation, you’re ensuring that your code will remain useful for a long time. Code should be self-documenting to a large degree, and you should put effort into automating most of the steps involved in generating figures and tables in your paper. However, you will still need to write some textual documentation.</p>
<p>You can take that occasion to reflect on your project. Sometimes, you’ll find that it’s more productive to rewrite bad code than to write complex explanations for it. At other times, especially at the very end of a project, refactoring will not be worth the effort, and you will have to let things go. As part of the documentation, you can write about how you could improve on your project. You can use a framing device device like <em>three lessons I learned in this project</em>. Learn from your mistakes and do better next time.</p>
<div class="admonition-minute-exercise admonition">
<p class="admonition-title">5-minute exercise</p>
<p>Add a README.md file to a project you’re working on right now</p>
</div>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="vanvliet"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Van Vliet (2020). <a class="reference external" href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1007358">Seven quick tips for analysis scripts in neuroimaging</a>. PLOS Computational Biology.</p>
</dd>
</dl>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cdminix/tts-for-asr",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./archive"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By <a href='https://cdminix.me'>Christoph Minixhofer</a> <a href='https://twitter.com/cdminix'><img height='24' width='24' src='_images/twitter.svg' alt='Twitter' style='width:24px'></a><br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            Licensed under CC-BY 4.0, Template based on <a href='https://goodresearch.dev'>goodresearch.dev</a>.
          </div>
      </p>
    </div>
  </footer>
  <!-- Place this tag in your head or just before your close body tag. -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>